# ===============================================================
# EV2Gym 仿真配置文件（对应论文 Diaz-Londono et al., EPSR 2026, Table 5）
# 场景：10 个充电桩（EVSE），25 辆电动汽车（EV），1 台变压器，
#      居民区充电行为（private，对应 residential），
#      放电价格系数 m = 1.2。
# ===============================================================

simulate_grid: true                  # 是否仿真电网潮流
pf_solver: PandaPower                # 潮流求解器：PandaPower 或 Laurent

# --------------------------- 电网模型设置 ---------------------------
network_info:
  include: true                      # 是否启用电网建模
  s_base: 100                        # 基准容量（kVA）
  bus_info_file: "E:/code/EV2gym/ev2gym/data/network_data/node_25/Nodes_25.csv"
  line_info_file: "E:/code/EV2gym/ev2gym/data/network_data/node_25/Lines_25.csv"
  branch_info_file: "E:/code/EV2gym/ev2gym/data/network_data/node_25/Lines_25.csv"
  transformer_info_file: null
  grid_voltage_base: 400             # 低压侧线电压基准（V）
  load_multiplier: 1.0               # 负荷倍数系数
  pv_scale: 100                      # 光伏输出比例（%）
  power_factor: 0.95                 # 功率因数
  grid_frequency: 50                 # 电网频率（Hz）
  grid_type: LV                      # 电压等级：LV = 低压
  load_flow_max_iter: 100            # 潮流计算最大迭代次数
  load_flow_tolerance: 1e-5          # 潮流收敛容差
  vm_pu: 1.0                         # 电压标幺值
  min_vm_pu: 0.95                    # 电压下限
  max_vm_pu: 1.05                    # 电压上限
  max_line_loading_percent: 100      # 线路最大载荷率（%）

# --------------------------- 仿真时间参数 ---------------------------
timescale: 15                        # 时间步长（分钟）
simulation_length: 96                # 一天 24h / 15min = 96 步
year: 2022
month: 1
day: 17
random_day: true                     # 每次运行随机选日期
hour: 0                              # 起始时间：00:00
minute: 0
simulation_days: weekdays            # 仿真工作日（weekdays）

# --------------------------- 车辆到站行为 ---------------------------
scenario: private                    # residential 行为对应 private 场景
spawn_multiplier: 2.5                # 控制 EV 数量生成倍率，约 25 辆车

# --------------------------- 电价与市场 ---------------------------
discharge_price_factor: 1.2          # 放电价格系数 m=1.2（Table 3）

# --------------------------- 充电网络结构 ---------------------------
v2g_enabled: true                    # 启用车网双向能量流（V2G）
number_of_charging_stations: 10      # 充电桩数量（EVSE）
number_of_transformers: 1            # 变压器数量
number_of_ports_per_cs: 1            # 每个充电桩的端口数
charging_network_topology: None      # 若为 None，则随机生成网络拓扑

# --------------------------- 功率设定 ---------------------------
power_setpoint_enabled: false        # 关闭功率参考点跟踪功能
power_setpoint_flexiblity: 10        # 功率灵活度（±%）

# --------------------------- 不可控负荷、光伏与需求响应 ---------------------------
tr_seed: -1                          # 随机种子，-1 表示每次随机
inflexible_loads:
  include: true
  inflexible_loads_capacity_multiplier_mean: 1.0   # 不可控负荷基准比例
  forecast_mean: 100                 # 负荷预测均值（%）
  forecast_std: 5                    # 负荷预测标准差（%）
solar_power:
  include: true
  solar_power_capacity_multiplier_mean: 1.0        # 光伏容量基准比例
  forecast_mean: 100                 # 光伏预测均值（%）
  forecast_std: 5                    # 光伏预测标准差（%）
demand_response:
  include: true
  events_per_day: 1                  # 每天 1 次需求响应事件
  event_capacity_percentage_mean: 20 # 削减容量 20%（论文表 4）
  event_capacity_percentage_std: 0
  event_length_minutes_min: 60       # 事件持续 60 min
  event_length_minutes_max: 60
  event_start_hour_mean: 18          # 平均发生在 18 点 ±1 h
  event_start_hour_std: 1
  notification_of_event_minutes: 60  # 提前 60 min 通知事件

# --------------------------- 电动汽车参数 ---------------------------
heterogeneous_ev_specs: false         # 所有车辆相同参数
ev_specs_file: ./ev2gym/data/ev_specs_v2g_enabled2024.json

# --------------------------- 模型默认参数（论文 Table 4） ---------------------------
transformer:
  max_power: 400                     # 变压器最大功率 400 kW（Table 4）

charging_station:
  min_charge_current: 0
  max_charge_current: 32
  min_discharge_current: 0
  max_discharge_current: -32
  voltage: 400                       # 三相线电压 400 V
  phases: 3

ev:
  battery_capacity: 50               # 电池容量 50 kWh
  max_ac_charge_power: 22            # 最大充电功率 22 kW
  min_ac_charge_power: 0
  max_dc_charge_power: 22
  max_discharge_power: -22           # 最大放电功率 22 kW（负号表示放电）
  min_discharge_power: 0
  ev_phases: 3
  charge_efficiency: 1.0             # 充放电效率 100%
  discharge_efficiency: 1.0
  transition_soc: 1
  min_battery_capacity: 50
  min_time_of_stay: 180              # 最少停留 3 小时（180 min）
  min_emergency_battery_capacity: 5  # 紧急保留电量 5 kWh
  desired_capacity: 0.8              # 离开时目标 SoC = 80%
  transition_soc_multiplier: 5
